<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <title>Mahjong Selector</title>
    <style>
        /* Add your CSS styling here */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var slots = [];
        var slots_flower = [];
        var slots_inside = [];
        var slots_outside = [];
        var InOrOut = 'in';
        var total_tiles = 17;
        var tiles_limit = 4;
        var arrayFlower = ["FB01", "FB02", "FB03", "FB04", "FR01", "FR02", "FR03", "FR04"];

        function slotsRefresh(){
            //Handle Outside (include Flowers)
            $("#slots_flower_container").empty();
            $("#slots_outside_container").empty();
            
            //Handle Flower
            var i = 0;
            while (i < slots_flower.length) {
                imageUrl = 'image/' + slots_flower[i] + '.png';
                var img = $("<img>").attr("src", imageUrl);
                // append the selected image
                $("#slots_flower_container").append(img);

                img.click(function() {
                    // Get the source of the clicked image
                    var imageUrl = $(this).attr("src");                    
                    var imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1, imageUrl.lastIndexOf("."));
                    slotsFlowerRemove(imageName)
                });

                i++;
            }

            //Handle Ouside
            var i = 0;
            while (i < slots_outside.length) {
                imageUrl = 'image/' + slots_outside[i] + '.png';
                var img = $("<img>").attr("src", imageUrl);
                // append the selected image
                $("#slots_outside_container").append(img);

                img.click(function() {
                    // Get the source of the clicked image
                    var imageUrl = $(this).attr("src");                    
                    var imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1, imageUrl.lastIndexOf("."));
                    slotsOutsideRemove(imageName)
                });

                i++;
            }

            //Handle Inside
            $("#slots_inside_container").empty();
            var i = 0;
            while (i < slots_inside.length) {
                imageUrl = 'image/' + slots_inside[i] + '.png';
                var img = $("<img>").attr("src", imageUrl);
                // append the selected image
                $("#slots_inside_container").append(img);
                
                img.click(function() {
                    // Get the source of the clicked image
                    var imageUrl = $(this).attr("src");                    
                    var imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1, imageUrl.lastIndexOf("."));
                    slotsInsideRemove(imageName)
                });

                i++;
            }

            //Add blank tiles
            var i = slots_inside.length + slots_outside.length;
            while (i < total_tiles) {
                imageUrl = 'image/_blank.png';
                var img = $("<img>").attr("src", imageUrl);
                // append the selected image
                $("#slots_inside_container").append(img);
                i++;
            }
        }

        function slotsAdd(imageName){
            //console.log(imageName);
            //console.log(isFlower(imageName));
            //console.log(isFlowerExist(imageName));
            if( isFlowerExist(imageName) == true ){
                //console.log('isFlowerExist');
                $("#label_message").html(' Flower only can put 1');
                return;
            }
            if( isFlower(imageName) == true ){
                //console.log('isFlower');
                slots_flower.push(imageName);
                slots_flower.sort();
                slotsRefresh();
                return;
            }

            if(countTiles(imageName) >= tiles_limit){
                $("#label_message").html(' Tiles only can put ' + tiles_limit);
                return;
            }

            switch(InOrOut){
                case "in":
                    slots_inside.push(imageName); // Add the new item to the array
                    slots_inside.sort();
                break;
                case "out":
                    slots_outside.push(imageName); // Add the new item to the array
                    slots_outside.sort();
                break;
            }
            slotsRefresh();
        }
        
        function slotsFlowerRemove(imageName){
            //console.log('slotsFlowerRemove');
            var isFirstMatch = true;
            slots_flower = $.grep(slots_flower, function(value) {
                if (value === imageName && isFirstMatch) {
                    isFirstMatch = false;
                    return false;
                }
                return true;
            });
            slotsRefresh();
        }

        function slotsInsideRemove(imageName){
            //console.log('slotsInsideRemove',slots_inside);
            var isFirstMatch = true;
            slots_inside = $.grep(slots_inside, function(value) {
                if (value === imageName && isFirstMatch) {
                    isFirstMatch = false;
                    return false;
                }
                return true;
            });
            slotsRefresh();
        }

        function slotsOutsideRemove(imageName){
            //console.log('slotsOutsideRemove');
            var isFirstMatch = true;
            slots_outside = $.grep(slots_outside, function(value) {
                if (value === imageName && isFirstMatch) {
                    isFirstMatch = false;
                    return false;
                }
                return true;
            });
            slotsRefresh();
        }

        function isFlower(para){
            var index = $.inArray(para, arrayFlower);
            //console.log(index,slots_flower);
            if (index !== -1) {
                return true;
            } else {
                return false;
            }
        }
        
        function isFlowerExist(imageName){
            var index = $.inArray(imageName, slots_flower);
            //console.log(index,slots_flower);
            if (index !== -1) {
                return true;
            } else {
                return false;
            }
        }

        function countTiles(imageName){
            return countTiles_flower(imageName) + countTiles_Inside(imageName) + countTiles_Outside(imageName);
        }

        function countTiles_flower(imageName){
            var count = 0;
            for (var i = 0; i < slots_flower.length; i++) {
                if (slots_flower[i] === imageName) {
                    count++;
                }
            }
            return count;
        }

        function countTiles_Inside(imageName){
            var count = 0;
            for (var i = 0; i < slots_inside.length; i++) {
                if (slots_inside[i] === imageName) {
                    count++;
                }
            }
            return count;
        }

        function countTiles_Outside(imageName){
            var count = 0;
            for (var i = 0; i < slots_outside.length; i++) {
                if (slots_outside[i] === imageName) {
                    count++;
                }
            }
            return count;
        }

        function slotsClear(){
            //$("#slots_container").empty();
            //slots = [];
            slots_flower = [];
            slots_inside = [];
            slots_outside = [];
            slotsRefresh();
        }

        $(document).ready(function() {
            //Disable Double-Tap Zoom on Mobile Browser
            javascript:document.querySelectorAll("*").forEach(e=>{e.style["touch-action"]="manipulation"}),new MutationObserver(e=>{e.forEach(function(e){for(var o=0;o<e.addedNodes.length;o++)e.addedNodes[o].style["touch-action"]="manipulation"})}).observe(document.body,{childList:!0,subtree:!0});
            
            slotsRefresh();
            /*
            $(".row_container img").click(function() {
                // Get the source of the clicked image
                var imageUrl = $(this).attr("src");
                
                var imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1, imageUrl.lastIndexOf("."));
                slotsRemove(imageName)
            });
            */
            $(".container img").click(function() {
                // Get the source of the clicked image
                var imageUrl = $(this).attr("src");
                
                // Limiting Slots Length
                var slotsExist = slots_inside.length + slots_outside.length;
                if (slotsExist >= total_tiles) {
                    //alert("Array length limit reached!");
                    $("#label_message").html(' Limit reached! Must below ' + total_tiles);
                    return; // Exit the function if the array length is already 17 or more
                }
                
                var imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1, imageUrl.lastIndexOf("."));
                slotsAdd(imageName);
                //slots_inside.push(imageName); // Add the new item to the array
                //slots_inside.sort();
                //slotsRefresh();
                
            });

                
$("#setting_showButton").click(function() {
    $("#setting_overlay").fadeIn();
});

$("#setting_closeButton").click(function() {
    $("#setting_overlay").fadeOut();
});

$("#showroom_showButton").click(function() {
    $("#showroom_overlay").fadeIn();
});

$("#showroom_closeButton").click(function() {
    $("#showroom_overlay").fadeOut();
});

$("#fillToInButton").click(function() {
    InOrOut = "in";
});

$("#fillToOutButton").click(function() {
    InOrOut = "out";
});
        });
	</script>
</head>
<body>
    <div id="setting_overlay">
        <div class="overlay-content">
            <button id="setting_closeButton">Close</button>
            <div class="setting-grid-container">
                <div class="setting-grid-item">
                    <span class="switch-text">Sort:</span>
                </div>
                <div class="setting-grid-item">
                    <input type="checkbox" id="sort_switch">
                    <label class="switch" for="sort_switch"></label>
                </div>
                <div class="setting-grid-item">
                    <span class="switch-text">Test:</span>
                </div>  
                <div class="setting-grid-item">
                    <input type="checkbox" id="test_Switch">
                    <label class="switch" for="test_Switch"></label>
                </div>  
                <div class="setting-grid-item">
                    <span class="switch-text">Total Tiles:</span>
                </div>  
                <div class="setting-grid-item">
                    <label class="radio_container">14
                        <input type="radio" checked="checked" name="total_tiles">
                        <span class="checkmark"></span>
                    </label>
                    <label class="radio_container">17
                        <input type="radio" name="total_tiles">
                        <span class="checkmark"></span>
                    </label>
                </div>   
                <div class="setting-grid-item">
                    <span class="switch-text">Tile Limit:</span>
                </div>  
                <div class="setting-grid-item">
                    <input type="checkbox" id="tile_limit_switch" checked>
                    <label class="switch" for="tile_limit_switch"></label>
                </div>  
              </div><!--end of setting-grid-container-->
        </div>
    </div>
    
    <div id="showroom_overlay">
        <div class="overlay-content">
            <button id="showroom_closeButton">Close</button>
            
        </div>
    </div>

    <div id="developer_area">
        <button id="setting_showButton">Setting</button>
        <button id="showroom_showButton">Show Room</button>
        <button onclick="slotsClear()">clear</button>
    </div>

    <div>
        <button id="fillToOutButton">Out</button>
        <button id="fillToInButton">In</button>
        <span id="slots_flower_container" class="row_container">
        </span>
        <span id="slots_outside_container" class="row_container">
        </span>
    </div>
    <div>
        <span id="slots_inside_container" class="row_container">
        </span>
    </div>
    <div id="slots_outside_container" class="row_container">
    </div>
    <div id="slots_inside_container" class="row_container">
    </div>
    <div id="message_container" class="msg_container">
        <label id="label_message"></label>
    </div>
    <div class="container">
        <img src="image/A01E.png">
        <img src="image/A02S.png">
        <img src="image/A03W.png">
        <img src="image/A04N.png">
        <img src="image/A05M.png">
        <img src="image/A06R.png">
        <img src="image/A07W.png">
    </div>
    <div class="container">
        <img src="image/C001.png">
        <img src="image/C002.png">
        <img src="image/C003.png">
        <img src="image/C004.png">
        <img src="image/C005.png">
        <img src="image/C006.png">
        <img src="image/C007.png">
        <img src="image/C008.png">
        <img src="image/C009.png">
    </div>
    <div class="container">
        <img src="image/L001.png">
        <img src="image/L002.png">
        <img src="image/L003.png">
        <img src="image/L004.png">
        <img src="image/L005.png">
        <img src="image/L006.png">
        <img src="image/L007.png">
        <img src="image/L008.png">
        <img src="image/L009.png">
    </div>
    <div class="container">
        <img src="image/T001.png">
        <img src="image/T002.png">
        <img src="image/T003.png">
        <img src="image/T004.png">
        <img src="image/T005.png">
        <img src="image/T006.png">
        <img src="image/T007.png">
        <img src="image/T008.png">
        <img src="image/T009.png">
    </div>
    <div class="container">
        <img src="image/FB01.png">
        <img src="image/FB02.png">
        <img src="image/FB03.png">
        <img src="image/FB04.png">
        <img src="image/FR01.png">
        <img src="image/FR02.png">
        <img src="image/FR03.png">
        <img src="image/FR04.png">
    </div>
    <div id="imagePopup" onclick="closePopup()">
        <!-- Pop up image will be displayed here -->
    </div>

</body>
</html>
